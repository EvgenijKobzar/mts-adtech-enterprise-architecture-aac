# **10. –°–∫–≤–æ–∑–Ω–æ–π SLA –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è**

---

## **10.1. SLA –Ω–∞ —ç—Ç–∞–ø–∞—Ö Pipeline**

### **–¶–µ–ª—å**

–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–æ—Ä–º–∞—Ç–∏–≤—ã –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º —Å—Ç–∞–¥–∏—è–º **Sales Pipeline**
–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –∏–∑–º–µ—Ä—è–µ—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–∞.

**SLA (Service Level Agreement)** ‚Äî —ç—Ç–æ —Ü–µ–ª–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤—Ä–µ–º–µ–Ω–∏, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö
–∑–∞–¥–∞—á–∏ –∏–ª–∏ —ç—Ç–∞–ø—ã —Å–¥–µ–ª–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω—ã.
–û–Ω–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Å–¥–µ–ª–∫–∞–º–∏.

---

### **–û—Å–Ω–æ–≤–Ω—ã–µ SLA –ø–æ —Å—Ç–∞–¥–∏—è–º Sales Pipeline**

| ‚Ññ | –≠—Ç–∞–ø (Stage)                  | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω / —Ä–æ–ª—å     | SLA (–≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è) | –ú–µ—Ç—Ä–∏–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è              | –¢–∏–ø SLA          |
| - | ----------------------------- | ------------------------------ | ---------------------- | ----------------------------- | ---------------- |
| 1 | **Lead Qualification**        | CRM / Pre-sales                | ‚â§ 1 —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å       | `lead‚Üíqualified`              | –ü—Ä–æ—Ü–µ—Å—Å–Ω—ã–π       |
| 2 | **Brief Collection**          | CRM / Sales-manager            | ‚â§ 2 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è        | `qualified‚Üíbriefed`           | –ü—Ä–æ—Ü–µ—Å—Å–Ω—ã–π       |
| 3 | **Media Plan Preparation**    | Task-Tracker / Account-manager | ‚â§ 3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è        | `briefed‚Üíoffer_ready`         | –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π |
| 4 | **Traffic Calculation**       | MediaPush / Traffic-manager    | ‚â§ 1 –¥–µ–Ω—å               | `offer_ready‚Üívalidated`       | –ü–æ–¥—ç—Ç–∞–ø          |
| 5 | **Contract Preparation**      | Docflow / Legal                | ‚â§ 2 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è        | `validated‚Üícontracting`       | –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π      |
| 6 | **Contract Signing**          | Docflow / Client               | ‚â§ 3 –¥–Ω—è                | `contracting‚Üícontract_signed` | –í–Ω–µ—à–Ω–∏–π          |
| 7 | **Campaign Launch**           | MediaPush / Operations         | ‚â§ 2 –¥–Ω—è                | `contract_signed‚Üílaunched`    | –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π |
| 8 | **Campaign Running / Report** | DCM / Billing                  | ‚â§ 7 –¥–Ω–µ–π               | `launched‚Üíclosed`             | –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π       |

> –í—Å–µ SLA —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ MasterDeal –∏ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ DWH —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è `masterdeal.sla.updated`.

---

### **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ SLA**

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å                   | –û–ø–∏—Å–∞–Ω–∏–µ                                              |
| ---------------------------- | ----------------------------------------------------- |
| **SLA Target (%)**           | –ü—Ä–æ—Ü–µ–Ω—Ç —Å–¥–µ–ª–æ–∫, –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –≤ –Ω–æ—Ä–º–∞—Ç–∏–≤. –¶–µ–ª—å ‚Äî ‚â• 90%. |
| **SLA Breach (%)**           | –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–π –ø–æ —ç—Ç–∞–ø–∞–º.                          |
| **Avg Time-to-Stage (—á–∞—Å—ã)** | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —Å—Ç–∞–¥–∏—è–º–∏.                |
| **Median Time (—á–∞—Å—ã)**       | –ú–µ–¥–∏–∞–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –≤–ª–∏—è–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π.      |
| **Escalation Level**         | –£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è (L1‚ÄìL3).                |

---

## **10.2. –ú–µ—Ö–∞–Ω–∏–∑–º –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ SLA**

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ä–æ–ª—å**

–ú–µ—Ö–∞–Ω–∏–∑–º SLA —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ —Å–≤—è–∑–∫—É:
**MasterDeal Service ‚Üí Integration Platform ‚Üí DWH (Data Warehouse).**

```mermaid
flowchart LR
  subgraph Domains[Domains]
    CRM[CRM]
    TT[Task-Tracker]
    DOC[Docflow]
    LEG[Legal]
    DCM[DCM]
    MP[MediaPush]
  end

  MD[(Operational MasterDeal Service)]
  IP[Integration Platform]
  DWH[(DWH / SLA Data Mart)]
  BI[Stage Dashboard]

  CRM -- raw events --> IP --> MD
  MP -- raw events --> IP --> MD
  DOC -- raw events --> IP --> MD
  LEG -- raw events --> IP --> MD
  DCM -- raw events --> IP --> MD

  MD -->|canonical events: masterdeal.sla.updated| IP
  IP --> DWH
  DWH --> BI
```

---

### **–ú–µ—Ö–∞–Ω–∏–∑–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è SLA**

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π.**
   MasterDeal —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞–¥–∏–π (`stage.entered_at`, `stage.exited_at`).

2. **–†–∞—Å—á—ë—Ç SLA-–∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤.**
   SLA Engine –≤—ã—á–∏—Å–ª—è–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (`t_exit - t_entry`) –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–º.

3. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö.**
   –í MasterDeal —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ `SLA_FACT` —Å –ø–æ–ª—è–º–∏:

   ```
   master_deal_id | stage_from | stage_to | duration | sla_norm | status | breach_flag | updated_at
   ```

4. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è.**
   –ï—Å–ª–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ ‚Äî —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ:

   ```json
   {
     "event_type": "masterdeal.sla.breached",
     "master_deal_id": "MDL-1045",
     "stage": "contracting",
     "duration": "P4D",
     "norm": "P2D",
     "delay_hours": 48,
     "responsible": "Docflow"
   }
   ```

5. **–ü–µ—Ä–µ–¥–∞—á–∞ –≤ DWH.**
   DWH –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è `sla.updated` –∏ `sla.breached` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –≤–∏—Ç—Ä–∏–Ω—É `fct_sla_masterdeal`.

6. **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.**
   BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç SLA –≤ –≤–∏–¥–µ Gantt –∏ KPI-–¥–∞—à–±–æ—Ä–¥–æ–≤.

---

### **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ DWH**

| –¢–∞–±–ª–∏—Ü–∞              | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                      | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| -------------------- | ----------------------------------------------- | ---------- |
| `dim_stage`          | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å—Ç–∞–¥–∏–π –∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–≤ SLA              | –°—Ç–∞—Ç–∏—á–Ω–æ   |
| `fct_sla_masterdeal` | –§–∞–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SLA –ø–æ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥—É | –ü–æ—Ç–æ–∫–æ–≤–æ   |
| `agg_sla_summary`    | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ —Ä–æ–ª—è–º –∏ –¥–æ–º–µ–Ω–∞–º    | –ï–∂–µ—á–∞—Å–Ω–æ   |
| `vw_sla_breached`    | –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π –¥–ª—è –û–ö–ö –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π   | –†–µ–∞–ª—Ç–∞–π–º   |

---

## **10.3. Gantt-–¥–∏–∞–≥—Ä–∞–º–º–∞ SLA**

**Gantt-–¥–∏–∞–≥—Ä–∞–º–º–∞** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–∞–¥–∏–π —Å–¥–µ–ª–∫–∏
–∏ –≤—ã—è–≤–ª–µ–Ω–∏—è —É–∑–∫–∏—Ö –º–µ—Å—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞.

### **–ü—Ä–∏–º–µ—Ä –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (–æ–¥–Ω–∞ —Å–¥–µ–ª–∫–∞)**

```mermaid
gantt
    dateFormat  YYYY-MM-DD
    title  MasterDeal #MDL-1045 ‚Äî SLA –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
    section CRM
    Lead Qualification      :done, des1, 2025-10-01, 2025-10-01
    Brief Collection        :done, des2, 2025-10-02, 2025-10-03
    section Account & Media
    Media Plan Preparation  :active, des3, 2025-10-04, 2025-10-06
    section Legal & Docflow
    Contract Preparation    :done, des4, 2025-10-07, 2025-10-08
    Contract Signing        :crit, des5, 2025-10-09, 2025-10-13
    section Campaign
    Campaign Launch         :done, des6, 2025-10-14, 2025-10-15
    Reporting & Closing     :done, des7, 2025-10-16, 2025-10-22
```

üü® *–ñ—ë–ª—Ç—ã–π (active)* ‚Äî —Ç–µ–∫—É—â–∏–π —ç—Ç–∞–ø
üü• *–ö—Ä–∞—Å–Ω—ã–π (crit)* ‚Äî –Ω–∞—Ä—É—à–µ–Ω–∏–µ SLA
üü© *–ó–µ–ª—ë–Ω—ã–π (done)* ‚Äî —ç—Ç–∞–ø –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ —Å—Ä–æ–∫

---

### **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ Gantt**

| –ê—Ç—Ä–∏–±—É—Ç              | –ó–Ω–∞—á–µ–Ω–∏–µ                | –ò—Å—Ç–æ—á–Ω–∏–∫              |
| -------------------- | ----------------------- | --------------------- |
| `start_date`         | `stage.entered_at`      | MasterDeal            |
| `end_date`           | `stage.exited_at`       | MasterDeal            |
| `sla_norm`           | –ù–æ—Ä–º–∞—Ç–∏–≤ –∏–∑ `dim_stage` | DWH                   |
| `breach_flag`        | Boolean                 | MasterDeal SLA Engine |
| `responsible_domain` | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω     | CRM, Media, Docflow   |
| `stage_name`         | –ù–∞–∑–≤–∞–Ω–∏–µ —ç—Ç–∞–ø–∞          | Canonical Model       |

---

## **10.4. –ï–¥–∏–Ω—ã–π Stage Dashboard**

### **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**

**Stage Dashboard** ‚Äî —ç—Ç–æ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–∞—à–±–æ—Ä–¥ –≤ BI,
–ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ –¥–∞–Ω–Ω—ã—Ö `DWH`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –∏ SLA –ø–æ –≤—Å–µ–º –¥–æ–º–µ–Ω–∞–º.

---

### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Dashboard**

| –í–∏–¥–∂–µ—Ç                      | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                           | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö      |
| --------------------------- | ------------------------------------ | -------------------- |
| **Pipeline Overview**       | –ö–æ–ª-–≤–æ —Å–¥–µ–ª–æ–∫ –Ω–∞ —Å—Ç–∞–¥–∏—è—Ö (bar chart) | `fct_stage_status`   |
| **SLA Performance Gauge**   | % —Å–æ–±–ª—é–¥–µ–Ω–∏—è SLA –ø–æ —ç—Ç–∞–ø–∞–º           | `agg_sla_summary`    |
| **Breach Heatmap**          | –ö–∞—Ä—Ç–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π SLA –ø–æ —Ä–æ–ª—è–º/–¥–æ–º–µ–Ω–∞–º | `vw_sla_breached`    |
| **Avg Time-to-Stage Trend** | –î–∏–Ω–∞–º–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Å—Ç–∞–¥–∏–π  | `fct_sla_masterdeal` |
| **Deal Tracker (Gantt)**    | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–¥–µ–ª–æ–∫ –ø–æ —Å—Ç–∞–¥–∏—è–º       | `fct_sla_masterdeal` |
| **Top-10 Delays**           | –ù–∞–∏–±–æ–ª–µ–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–¥–µ–ª–∫–∏           | `vw_sla_breached`    |

---

### **–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Stage Dashboard**

```mermaid
graph TD
  A[Pipeline Overview] --> D[Deal Tracker Gantt]
  B[SLA Performance Gauge] --> D
  C[Breach Heatmap] --> D
  E[Avg Time-to-Stage Trend] --> B
  F[Top-10 Delays] --> C
```

---

### **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å Dashboard**

* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ: `–¥–æ–º–µ–Ω—É`, `—Ä–æ–ª–∏`, `–∫–ª–∏–µ–Ω—Ç—É`, `stage`, `–ø–µ—Ä–∏–æ–¥—É`.
* –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:

    * üü© –≤ —Å—Ä–æ–∫, üü® —Ä–∏—Å–∫, üü• –Ω–∞—Ä—É—à–µ–Ω–∏–µ.
* Drill-down –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–¥–µ–ª–∫–∏ –∏ –µ—ë –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π.
* –≠–∫—Å–ø–æ—Ä—Ç SLA-–æ—Ç—á—ë—Ç–∞ –≤ PDF/Excel.
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MasterDeal API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ‚Äú–∂–∏–≤–æ–≥–æ‚Äù —Å—Ç–∞—Ç—É—Å–∞ (`real-time refresh`).

---

### **–ü—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –≤ Dashboard**

| –ú–µ—Ç—Ä–∏–∫–∞                      | –§–æ—Ä–º—É–ª–∞                    | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
| ---------------------------- | -------------------------- | ---------------- |
| **SLA Compliance (%)**       | `(on_time / total) * 100`  | ‚â• 90%            |
| **Avg Time-to-Contract (—á)** | `Œ£(contract_time) / count` | ‚â§ 72 —á           |
| **Avg Time-to-Launch (—á)**   | `Œ£(launch_time) / count`   | ‚â§ 48 —á           |
| **SLA Breach Count**         | `count(breach_flag=true)`  | ‚Äî                |
| **Escalations Level 2+**     | `count(level>=2)`          | ‚â§ 5% –æ—Ç –≤—Å–µ—Ö     |


---

## **10.5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ SLA Engine**

### **10.5.1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**

**SLA Engine** ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Operational MasterDeal Service, –∫–æ—Ç–æ—Ä—ã–π:

* —Å—Ç–∞—Ä—Ç—É–µ—Ç/–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä—ã –ø—Ä–∏ –≤—Ö–æ–¥–µ/–≤—ã—Ö–æ–¥–µ —Å–¥–µ–ª–∫–∏ –∏–∑ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∞–¥–∏–π;
* —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –Ω–æ—Ä–º–∞—Ç–∏–≤–∞–º–∏;
* –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è `masterdeal.sla.updated` / `masterdeal.sla.breached`;
* –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç —ç—Å–∫–∞–ª–∞—Ü–∏–∏ (L1/L2/L3) —á–µ—Ä–µ–∑ Integration Platform.

---

### **10.5.2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è —Å—Ö–µ–º–∞**

```mermaid
graph TB
  classDef box fill:#f8fafc,stroke:#334155,stroke-width:1px,rx:6,ry:6

  subgraph MD[Operational MasterDeal Service]
    AGG[Stage Aggregator]:::box
    SLAE[SLA Engine]:::box
    TMR[Timer Store / Scheduler]:::box
    CFG[SLA Config dim_stage]:::box
    OUTBX[Transactional Outbox]:::box
    DB[(MasterDeal DB + fct_sla)]:::box
  end

  subgraph IP[Integration Platform]
    BUS[Event Bus Kafka/ESB]
    NOTIF[Notification/Escalation]
    DWH[DWH/BI Ingest]
  end

  AGG -- stage.changed --> SLAE
  SLAE -- read --> CFG
  SLAE -- start/stop --> TMR
  TMR --> SLAE
  SLAE -- write facts --> DB
  SLAE --> OUTBX
  OUTBX --> BUS
  BUS --> NOTIF
  BUS --> DWH
```

**–ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã**

* **Stage Aggregator** ‚Äî –≤—ã—á–∏—Å–ª—è–µ—Ç aggregated stage (–≥–µ–π—Ç—ã ‚Üí —ç—Ç–∞–ø).
* **SLA Engine** ‚Äî —á–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ SLA (—Ç–∞–π–º–µ—Ä—ã, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, —ç—Å–∫–∞–ª–∞—Ü–∏–∏).
* **Timer Store/Scheduler** ‚Äî –Ω–∞–¥—ë–∂–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã (persisted timers / delayed jobs).
* **Transactional Outbox** ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –≤ —à–∏–Ω—É.
* **dim_stage** ‚Äî –∫–∞—Ç–∞–ª–æ–≥ –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–≤ (SLA —Ü–µ–ª–∏, —É—Ä–æ–≤–Ω–∏ —ç—Å–∫–∞–ª–∞—Ü–∏–∏).

---

### **10.5.3. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: —Å—Ç–∞—Ä—Ç/—Å—Ç–æ–ø —Ç–∞–π–º–µ—Ä–∞ –∏ breach**

```mermaid
sequenceDiagram
  autonumber
  participant AGG as Stage Aggregator
  participant SLA as SLA Engine
  participant TMR as Timer Store/Scheduler
  participant DB as MasterDeal DB
  participant OUT as Outbox
  participant BUS as Event Bus
  participant IP as Integration Platform

  AGG->>SLA: stage.changed {from: briefed, to: offer_ready}
  SLA->>DB: upsert fct_sla (start: briefed‚Üíoffer_ready)
  SLA->>TMR: schedule(stopAt = now + norm(briefed‚Üíoffer_ready))
  TMR-->>SLA: timerId

  Note over SLA,TMR: ... –≤—Ä–µ–º—è –∏–¥—ë—Ç ...

  AGG->>SLA: stage.changed {from: offer_ready, to: contracting}
  SLA->>TMR: stop(timerId)  // —Ä–µ–∞–ª—å–Ω—ã–π stop –ø–æ –≤—Ö–æ–¥—É –≤ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø
  SLA->>DB: finalize duration; 
  SLA->>OUT: enqueue masterdeal.sla.updated
  OUT->>BUS: publish (exactly-once)
  BUS-->>IP: route to DWH/BI

  Note over TMR: –µ—Å–ª–∏ —Ç–∞–π–º–µ—Ä –∏—Å—Ç—ë–∫ –¥–æ stage.changed

  TMR-->>SLA: timer.expired(timerId)
  SLA->>DB: mark breach (delay_hours, level)
  SLA->>OUT: enqueue masterdeal.sla.breached
  OUT->>BUS: publish
  BUS-->>IP: trigger escalation (L1/L2/L3)
```

---

### **10.5.4. –î–∞–Ω–Ω—ã–µ –∏ –Ω–æ—Ä–º–∞—Ç–∏–≤—ã**

**–ö–∞—Ç–∞–ª–æ–≥ SLA (dim_stage):**

* `stage_from`, `stage_to`
* `norm_duration` (ISO 8601, –Ω–∞–ø—Ä. `P2D`, `PT8H`)
* `working_calendar` (—É—á—ë—Ç —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤/–ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤)
* `escalation_levels`: `{L1: 80% norm, L2: 100%, L3: 120%}`

**–§–∞–∫—Ç—ã SLA (fct_sla_masterdeal):**

```
master_deal_id | stage_from | stage_to | start_at | stop_at
duration_sec   | norm_sec   | status(OK/BREACH) | breach_level(L1..L3)
owner_domain   | owner_user | updated_at
```

---

### **10.5.5. –ê–ª–≥–æ—Ä–∏—Ç–º—ã (–≤–∫—Ä–∞—Ç—Ü–µ)**

**A. –°—Ç–∞—Ä—Ç —Ç–∞–π–º–µ—Ä–∞**

1. –ù–∞ `stage.changed(to = X)` –∏—â–µ–º –ø—Ä–∞–≤–∏–ª–æ `prev‚ÜíX` –≤ `dim_stage`.
2. –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –µ—Å—Ç—å ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ–º `start_at = now`, –ø–ª–∞–Ω–∏—Ä—É–µ–º —Ç–∞–π–º–µ—Ä –Ω–∞ `now + norm(X)`.
3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–ø–∏—Å—å `status=PENDING`.

**B. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–∞**

1. –ù–∞ `stage.changed(from = X)` –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ `prev‚ÜíX`:

   * `stop_at = now`, `duration = stop-start`.
   * –ï—Å–ª–∏ `duration ‚â§ norm` ‚Üí `OK`, –∏–Ω–∞—á–µ `BREACH` –∏ —É—Ä–æ–≤–µ–Ω—å –ø–æ –ø–æ—Ä–æ–≥–∞–º.
   * –ü—É–±–ª–∏–∫—É–µ–º `masterdeal.sla.updated`.

**C. –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ (breach)**

1. –ü–æ —Å–∏–≥–Ω–∞–ª—É `timer.expired`:

   * –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω –ª–∏ —É–∂–µ –ø–µ—Ä–µ—Ö–æ–¥.
   * –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–æ–º–µ—á–∞–µ–º `BREACH`, —Å—á–∏—Ç–∞–µ–º `delay_hours`, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º `L1..L3`.
   * –ü—É–±–ª–∏–∫—É–µ–º `masterdeal.sla.breached`.

**D. –£—á—ë—Ç —Ä–∞–±–æ—á–µ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è**

* –ü—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ –ø–ª–∞–Ω–æ–≤–æ–π –¥–∞—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å: `add_business_duration(start, norm, calendar)`.

---

### **10.5.6. –ü—Ä–∏–º–µ—Ä —Å–æ–±—ã—Ç–∏–π**

**`masterdeal.sla.updated`**

```json
{
  "event_type": "masterdeal.sla.updated",
  "master_deal_id": "MDL-1203",
  "transition": {"from":"briefed","to":"offer_ready"},
  "duration_sec": 46800,
  "norm_sec": 57600,
  "status": "OK",
  "owner": {"domain":"Account","team":"MediaOps"},
  "timestamp": "2025-10-28T08:55:21Z"
}
```

**`masterdeal.sla.breached`**

```json
{
  "event_type": "masterdeal.sla.breached",
  "master_deal_id": "MDL-1203",
  "transition": {"from":"contracting","to":"launching"},
  "delay_hours": 16,
  "breach_level": "L2",
  "owner": {"domain":"Docflow","team":"Contracts"},
  "actions": ["notify.owner","open.ticket","escalate.L2"],
  "timestamp": "2025-10-29T12:03:00Z"
}
```

---

### **10.5.7. –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏**

| –†–∏—Å–∫                             | –ú–∏—Ç–∏–≥–∏—Ä—É—é—â–∞—è –º–µ—Ä–∞                                                      |
| -------------------------------- | ---------------------------------------------------------------------- |
| –î—É–±–ª–∏–∫–∞—Ç—ã —Å–æ–±—ã—Ç–∏–π                | –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (`event_id`, inbox, upsert)                            |
| –ü–æ—Ç–µ—Ä—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏                | Transactional Outbox + —Ä–µ—Ç—Ä–∞–∏ –≤ —à–∏–Ω—É                                   |
| –ü–∞–¥–µ–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–∞                 | Persisted timers; –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–¥—ä—ë–º –ø–æ–¥–±–µ—Ä—ë—Ç —Ç–∞–π–º–µ—Ä—ã                    |
| –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏        | –°–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è —Å–µ—Ä–≤–∏—Å–∞ + `occurred_at` –∏–∑ —Å–æ–±—ã—Ç–∏—è, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ UTC |
| –ù–µ–≤–µ—Ä–Ω—ã–π —Ä–∞—Å—á—ë—Ç –∏–∑-–∑–∞ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ | –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∏ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è            |

---

### **10.5.7. –ú–µ—Ç—Ä–∏–∫–∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏ (Prometheus)**

* `sla_active_timers_total` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã.
* `sla_transition_duration_seconds{from,to}` ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π.
* `sla_breach_total{level,from,to,domain}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π.
* `sla_publish_lag_seconds` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ —à–∏–Ω—É.
* `sla_compute_latency_ms` ‚Äî p50/p95 —Ä–∞—Å—á—ë—Ç–∞.

---

## **10.6. –ò—Ç–æ–≥ –ø–æ —Ä–∞–∑–¥–µ–ª—É**

–°–∏—Å—Ç–µ–º–∞ **—Å–∫–≤–æ–∑–Ω–æ–≥–æ SLA –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

* –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–∞;
* –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ–∏–∫—Å–∞—Ü–∏—é –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—é SLA –Ω–∞ —É—Ä–æ–≤–Ω–µ MasterDeal;
* –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å DWH –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏;
* –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –≤ –≤–∏–¥–µ Gantt –∏ Stage Dashboard –¥–ª—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π;
* –º–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —ç—Å–∫–∞–ª–∞—Ü–∏–π –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö.

> **MasterDeal + DWH + Stage Dashboard** —Å–æ–∑–¥–∞—é—Ç —Ü–∏—Ñ—Ä–æ–≤–æ–π –∫–æ–Ω—Ç—É—Ä ‚Äú–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è‚Äù,
> –≥–¥–µ –∫–∞–∂–¥–∞—è —Å–¥–µ–ª–∫–∞ –≤–∏–¥–Ω–∞, –∏–∑–º–µ—Ä—è–µ–º–∞ –∏ —É–ø—Ä–∞–≤–ª—è–µ–º–∞—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

SLA Engine –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π stage –≤ **—É–ø—Ä–∞–≤–ª—è–µ–º–æ–µ –≤—Ä–µ–º—è**:

* –Ω–∞–¥—ë–∂–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã –∏ –Ω–æ—Ä–º–∞—Ç–∏–≤—ã,
* –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã,
* real-time —Å–æ–±—ã—Ç–∏—è –∏ —ç—Å–∫–∞–ª–∞—Ü–∏–∏,
* –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ DWH.