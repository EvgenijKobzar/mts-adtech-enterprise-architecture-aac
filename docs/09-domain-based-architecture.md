# **9. Архитектура по доменам**

---

## **9.1. Архитектурные драйверы**

| Категория                        | Драйвер                                      | Описание                                                                                    |
| -------------------------------- | -------------------------------------------- | ------------------------------------------------------------------------------------------- |
| **Бизнес**                       | Сквозное управление сделкой                  | Необходимость единого pipeline от лида до отчёта.                                           |
| **Организационный**              | Разделение ответственности между ролями      | CRM, MediaPush, Docflow, Legal и DCM действуют независимо, но должны быть синхронизированы. |
| **Технологический**              | Интеграция через шину (Integration Platform) | Минимизация связей “точка-точка”, переход к event-driven и REST API.                        |
| **Аналитический**                | DWH как единый источник аналитической правды | Централизация SLA, KPI и BI на уровне MasterDeal и DWH.                                     |
| **Автоматизация / AI**           | LLM Copilot                                  | Включение LLM для генерации медиапланов и КП.                                               |
| **Управляемость и контроль SLA** | Monitoring и Observability                   | Построение единой картины SLA по доменам.                                                   |

---

## **9.2. Ограничения — бизнесовые и технологические рамки**

| Тип                 | Ограничение                                          | Влияние                                                     |
| ------------------- | ---------------------------------------------------- | ----------------------------------------------------------- |
| **Бизнес**          | Разные процессы по типам клиентов (B2B / SMB)        | Необходимо гибко настраивать pipeline.                      |
| **Бизнес**          | Взаимодействие с внешними подрядчиками и агентствами | Требуется безопасный API и SLA-контроль.                    |
| **Технологическое** | Наследованные CRM и MediaPush                        | Ограничена скорость изменений интерфейсов и моделей данных. |
| **Технологическое** | Отсутствие единого ID клиента                        | Необходим реестр связей в MasterDeal.                       |
| **Технологическое** | Различные модели аутентификации                      | Требуется единая авторизация через Integration Platform.    |
| **Организационное** | Несогласованность KPI между отделами                 | Решается унификацией SLA в MasterDeal.                      |

---

## **9.3. Функциональные требования**

| Домен            | Основные функции                                            | Интеграции                         |
| ---------------- | ----------------------------------------------------------- | ---------------------------------- |
| **CRM**          | Управление лидами, сделками, клиентами и контактами.        | MasterDeal, Docflow, DWH.          |
| **Task-Tracker** | Постановка и контроль задач между Sales, Account и Traffic. | CRM, MasterDeal.                   |
| **MediaPush**    | Формирование и запуск медиапланов, расчёт KPI.              | MasterDeal, DCM.                   |
| **Docflow-ops**  | Создание и согласование договоров.                          | CRM, MasterDeal, Legal.            |
| **Legal-ops**    | Юридическая проверка КП, договоров, документов.             | MasterDeal, Docflow.               |
| **DCM**          | Учёт транзакций, формирование счетов и актов.               | MasterDeal, DWH.                   |
| **DWH**          | Хранение агрегированных данных и аналитика.                 | MasterDeal (канонические события). |

---

## **9.4. Стейкхолдеры**

| Роль                           | Интересы                                                | Метрики успеха                         |
| ------------------------------ | ------------------------------------------------------- | -------------------------------------- |
| **Руководитель отдела продаж** | Прозрачный Sales Pipeline, SLA, аналитика.              | Время цикла сделки, выполнение плана.  |
| **Sales-manager**              | Управление лидами и сделками, взаимодействие с Account. | Time-to-Offer, конверсия лидов.        |
| **Account-manager**            | Формирование медиаплана и продукта кампании.            | Качество медиапланов, точность KPI.    |
| **Traffic-manager**            | Расчёт размещений, взаимодействие с Account.            | SLA исполнения задач, точность охвата. |
| **Legal / Docflow**            | Корректность документов и сроков.                       | Время на согласование договора.        |
| **ОКК**                        | Контроль качества взаимодействия с клиентами.           | NPS, SLA.                              |
| **DWH / BI команда**           | Консолидация данных и отчётность.                       | Целостность данных, latency <10 сек.   |

---

## **9.5. Пользовательские сценарии**

1. **Создание лида и конвертация в сделку (CRM)**
   → Sales создаёт лид → определяет ICP → конвертирует в сделку → событие `crm.deal.created`.

2. **Формирование медиаплана (Account, MediaPush)**
   → Account получает бриф → ставит задачи Traffic → получает расчёты → формирует медиаплан → событие `media.mediaplan.ready`.

3. **Согласование договора (Docflow, Legal)**
   → Docflow формирует договор → Legal проверяет → событие `docflow.contract.signed`.

4. **Выставление счёта и закрытие сделки (DCM)**
   → DCM выставляет счёт → получает оплату → формирует УПД → `dcm.invoice.issued` → `masterdeal.closed`.

5. **Мониторинг SLA и отчётность (DWH)**
   → DWH получает события → формирует SLA Dashboard → уведомляет при нарушении SLA.

---

## **9.6. Критические сценарии (SLA-чувствительные)**

| Сценарий            | SLA              | Контроль              |
| ------------------- | ---------------- | --------------------- |
| Lead → Deal         | ≤ 2 часа         | CRM / MasterDeal      |
| Brief → Mediaplan   | ≤ 1 рабочий день | MasterDeal SLA Engine |
| Contract → Signed   | ≤ 3 дня          | Docflow / Legal       |
| Invoice → Payment   | ≤ 5 дней         | DCM / MasterDeal      |
| Синхронизация stage | ≤ 5 секунд       | Integration Platform  |

---

## **9.7. Атрибуты качества**

| Атрибут                | Цель                                    | Механизм реализации                      |
| ---------------------- | --------------------------------------- | ---------------------------------------- |
| **Производительность** | Обработка 10k событий/мин               | Kafka, Consumer Groups, Async processing |
| **Масштабируемость**   | Горизонтальное масштабирование сервисов | Kubernetes, autoscaling                  |
| **Надёжность**         | 99.9% uptime                            | Multi-AZ deployment                      |
| **Наблюдаемость**      | Трассировка событий                     | Prometheus + Grafana + Jaeger            |
| **Безопасность**       | RBAC, JWT, TLS                          | Integration Platform Security Layer      |
| **Идемпотентность**    | Исключение дубликатов                   | Event ID + Outbox pattern                |



## **9.8. Итог по разделу**

Раздел «Архитектура по доменам» описывает **цельную техническую модель взаимодействия** всех компонентов рекламной экосистемы МТС Stream.
MasterDeal выполняет **роль сквозного интеграционного ядра**, обеспечивая согласованность данных, SLA и событий во всех доменах.
Такой подход делает архитектуру:

* **масштабируемой**,
* **наблюдаемой**,
* **управляемой**,
* и готовой к дальнейшей AI-автоматизации и расширению.
