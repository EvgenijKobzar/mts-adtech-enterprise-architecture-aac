# Оценка атрибутов качества на основании критичных сценариев (мета-домен Master-Deal)

* **UC1** — Импорт лида и создание Master-Deal (real-time, из форм/API/источников).
* **UC2** — Дедупликация и слияние сделок/контрагентов (mastering & merge).
* **UC3** — Генерация медиаплана/КП на базе LLM и справочников.
* **UC4** — Двунаправленная синхронизация Master-Deal ↔ CRM/ERP.
* **UC5** — Сквозной SLA-контроль стадий конвейера, алерты.
* **UC6** — Подписание договора / запуск кампании (Time-to-Launch критичен).

---

## QA1: Доступность (UC1, UC2, UC4, UC5, UC6)

**Сценарий 1 (UC1):** сервис приёма лидов доступен 24×7, **SLO аптайма ≥ 95%/квартал**.
— При частичной деградации отключаем обогащение в real-time, складируем события в очередь (durable).
**Критерии приёмки:** ≤ 22 мин совокупного простоя/мес; не потеряно ни одного события (0 data-loss).

**Сценарий 2 (UC4):** веб-хуки/интеграции с CRM не «роняют» платформу.
— При недоступности CRM — повторные попытки по экспоненте, **DLQ**-канал, ручной ре-драйв.
**Критерии:** успешная доставка ≥ 99,9% за 1 час; видимость статуса доставки в дашборде.

**Сценарий 3 (UC5/UC6):** дашборды SLA и запуск кампании доступны бизнесу в часы нагрузки.
**Критерии:** RTO для UI ≤ 5 мин (активация read-only режима при аварии), RPO ≤ 1 мин для событий.

---

## QA2: Производительность (UC1, UC2, UC3, UC4)

**Сценарий 1 (UC1):** при пиковой подаче **200 rps** лидов p95-латентность создания Master-Deal ≤ **500 мс**.
— Используются батчи на запись, асинхронные саги, idempotency-keys.

**Сценарий 2 (UC2):** дедупликация по fuzzy-метрикам на лету.
**Критерии:** p95 ответа сервиса matching ≤ **800 мс** на окно поиска по 10 млн записей (индексы + векторный кеш).

**Сценарий 3 (UC3):** генерация КП/медиаплана.
**Критерии:** p95 ≤ **10 с** при холодном старте модели; ≤ **3 с** при тёплом кеше справочников.

**Сценарий 4 (UC4):** выгрузка 10k изменений в CRM.
**Критерии:** пропускная способность ≥ **2k событий/мин** без деградации UI.

---

## QA3: Масштабируемость (UC1, UC2, UC3, UC4, UC5)

**Сценарий 1 (UC1/UC4):** сезонный всплеск ×5.
**Критерии:** горизонтальное авто-масштабирование по очередям и CPU; **без ручных операций**.

**Сценарий 2 (UC2):** рост эталонного справочника до 100 млн контрагентов.
**Критерии:** шардинг по регионам/тенантам; линейная деградация < 10% при удвоении данных.

**Сценарий 3 (UC3/UC5):** параллельные запросы к LLM и SLA-агрегациям.
**Критерии:** изоляция пулов (LLM pool / OLAP pool), отсутствие взаимного влияния при росте нагрузки.

---

## QA4: Отказоустойчивость (UC1, UC2, UC4, UC5, UC6)

**Сценарий 1 (общий):** потеря одного узла БД/брокера.
**Критерии:** кластер с quorum, автоматическое перезаисключение; **RTO ≤ 5 мин, RPO ≤ 1 мин**.

**Сценарий 2 (UC4):** длительный даунстрим CRM.
**Критерии:** back-pressure + rate-limit, DLQ с TTL ≥ 72 ч, консоль reprocess; **0 потерянных событий**.

**Сценарий 3 (UC6):** сбой сервиса e-подписей.
**Критерии:** graceful-degradation — оффлайн-подписание с последующей синхронизацией; журнал событий неизменяемый.

---

## QA5: Удобство использования (UC1, UC2, UC3, UC5, UC6)

**Сценарий 1 (UC2):** оператор подтверждает merge.
**Критерии:** UX «одно окно»: карточка Master-Deal + side-by-side сравнение; откат merge в 1 клик; понятные причины совпадения.

**Сценарий 2 (UC3):** конструктор КП.
**Критерии:** пресеты, авто-подбор инвентаря, inline-валидации SLA; доступность функций с клавиатуры; p95 времени рендера UI ≤ **200 мс**.

**Сценарий 3 (UC5):** дашборд SLA.
**Критерии:** цветовые сигналы по SLO, фильтры по стадиям, «почему я вижу алерт» (explainability), экспорт в 1 клик.

---

## QA6: Безопасность (UC1, UC2, UC3)

**Сценарий 1 (UC1/UC2):** обработка Personally Identifiable Information(PII) и коммерческих условий.
**Критерии:** шифрование **at-rest (AES-256)** и **in-transit (mTLS)**, токенизация контактов; маскирование в логах.

**Сценарий 2 (UC3):** вызовы LLM.
**Критерии:** изоляция тенантов, запрет вывода сырой PII в промпт, allow-list атрибутов, контент-фильтры.

**Сценарий 3 (общий):** доступ к объектам Master-Deal.
**Критерии:** **RBAC + ABAC** (роль × стадия × тенант), аудит неизменяемый (append-only), ретеншн 365+ дней; ручные действия подписываются служебными ключами.

---

## QA7: Расширяемость (UC1, UC2, UC3, UC4)

**Сценарий 1:** событийная модель.
**Критерии:** **каноничные бизнес-события** (DealCreated, DealMerged, StageChanged, QuoteIssued) с версионированием **vN** и схемами в **Schema Registry**; политика эволюции — backward-compatible.

**Сценарий 2:** внешние плагины/интеграции.
**Критерии:** **API-шлюз** с версионированием /v1,/v2; расширения через webhooks & connector-SDK; time-boxed внедрение нового коннектора ≤ **2 недели** без релиза ядра.

**Сценарий 3:** бизнес-правила.
**Критерии:** rules-engine/feature-flags для включения/изменения логики (например, новая логика scoring) **без деплоя**, покрыто контрактными тестами.

---

## QA8 (опционально): Наблюдаемость/мониторинг (UC1–UC6)

**Сценарий 1:** трассировка саг и событий.
**Критерии:** distributed tracing (корреляция по dealId/traceId), SLO-метрики по стадиям, error-budgets.

**Сценарий 2:** качество данных.
**Критерии:** профилирование (freshness, completeness), алерты на дрейф справочников, отчёт о дедупликации.

---

Таким образом, оценка атрибутов качества предполагает:

* **Доступность** – Система должна **обеспечивать аптайм ≥ 95%** (целевой SLO); при деградации работать в режиме очередей и ретраев.
* **Производительность** – Система должна **обеспечивать p95 времени отклика API ≤ 500 мс**, загрузку основных UI-экранов **≤ 2 с**, генерацию КП/медиаплана **p95 ≤ 10 с** (≤ 3 с при тёплом кеше).
* **Масштабируемость** – Система должна **поддерживать горизонтальное и вертикальное масштабирование** для сервисов, брокеров и БД, авто-масштабирование по очередям/CPU, шардинг справочников.
* **Отказоустойчивость** – Система должна соответствовать **RTO ≤ 5 минут, RPO ≤ 1 минуты**, иметь DLQ и механизмы повторной доставки без потерь.
* **Безопасность** – Хранение персональных и конфиденциальных данных должно **соответствовать требованиям законодательства**; применяется шифрование in-transit и at-rest, **RBAC/ABAC**, токенизация PII, неизменяемый аудит.
* **Расширяемость (модифицируемость)** – Система должна **поддерживать версионирование API и событий, подключаемые коннекторы/вебхуки, feature-flags/rules-engine** для изменения логики без релиза ядра; поставка изменений — короткими инкрементами.
