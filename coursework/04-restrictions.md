## Ограничения мета-домена Master-Deal

### Бизнесовые ограничения

* **Источник истины:** финансовые условия и статусы закрытия — только из ERP/биллинга, не из CRM.
* **Единая нумерация:** уникальность по связке *организация × клиент × кампания × период*, без ручных кодов.
* **SLA по стадиям пайплайна:** (Lead → MQL → SQL → Offer → Launch → Invoice) — жёсткие дедлайны и штрафы за просрочку.
* **Единый глоссарий:** использовать каноничные термины («мастер-сделка», «экзекьюшн-заказ», «медиаплан»); локальные названия запрещены.
* **Незапрещённость ретроспективы:** после выставления счёта изменения условий — только через корректирующие документы.
* **Отчётные витрины read-only:** аналитика не изменяет операционные данные.
* **Конфиденциальность условий:** разграничение доступа по клиентам, регионам и ролям.
* **Трассировка происхождения данных:** обязательный data lineage для KPI и финансовых полей.
* **Политика скидок/апрувалов:** изменение прайса — только через утверждённые процессы.
* **Многоюрисдикционность:** налоги, валюты, НДС/VAT, курсы — по правилам региона клиента.
* **Обязательные атрибуты при создании:** клиент, продукт, валюта, период, владелец.
* **Разделение ответственности:** мастер-сделка — операционный домен; прибыль/отчётность — финансовый домен.
* **Версионирование медиаплана:** хранение всех версий; актуализация — только через workflow.
* **Запрет обходов:** запуск кампаний вне мастер-домена не допускается.
* **Ретенция документов:** хранение договоров/КП/актов не менее **[N лет]** по требованиям комплаенса.

### Технологические ограничения

* **Единый Operational MasterDeal Service:** централизованные CRUD и бизнес-правила.
* **Интеграции — event-driven first:** шина событий (Kafka/RabbitMQ), сырые и каноничные события.
* **Согласованность:** eventual межсистемно; транзакционная — внутри мастер-сервиса.
* **Версионирование контрактов:** API vN; схемы событий — семантические версии с обратной совместимостью.
* **Идемпотентность и дедупликация:** обязательная обработка повторов и «разворотов» сообщений.
* **Производительность:** p95 чтения ≤ **[X мс]**, записи ≤ **[Y мс]**; пропускная способность ≥ **[Z событий/с]**.
* **Доступность:** SLO чтение ≥ **99.9%**, изменение ≥ **99.5%**; регламентные окна — по расписанию.
* **Хранилище:** нормализованная OLTP-модель + журнал доменных событий; отчётные витрины — отдельно.
* **Неизменяемость событий:** исправления — компенсирующими событиями, не редактированием истории.
* **Безопасность:** OAuth2/OIDC, mTLS между сервисами, сквозной аудит (кто/что/когда/почему).
* **Управление схемой:** миграции через CI/CD, blue-green/rolling; запрет «горячих» ALTER без плана отката.
* **Доступ к данным:** внешний доступ — только через API Gateway/шину; прямой доступ к БД запрещён.
* **Наблюдаемость:** TraceID в событиях, метрики процентовок, алерты по SLO и задержкам очередей.
* **Лимиты полезной нагрузки:** размер события/API-запроса ограничен; крупные вложения — через объектное хранилище.
* **Политика ретенции:** OLTP-таблицы — **[N месяцев]**, архив/даталейк — **[M лет]**, с учётом GDPR/права на удаление.
* **Мультирегиональность:** логически единая сущность, физическое разделение по требованиям GDPR/локализации.
* **Каталог данных:** регистрация атрибутов мастер-сделки в data catalog с описаниями и владельцами.
* **Запросы на OLTP:** тяжёлые аналитические JOIN/сканы — запрещены; использовать реплики/витрины.
* **Тестируемость:** consumer-driven контракты для API/событий; фикстуры доменных сценариев обязательны.
* **Единое время:** все события в UTC, точность ≥ миллисекунда, детерминированные правила тайм-зон.
